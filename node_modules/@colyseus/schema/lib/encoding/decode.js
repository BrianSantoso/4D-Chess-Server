"use strict";
/**
 * Copyright (c) 2018 Endel Dreyer
 * Copyright (c) 2014 Ion Drive Software Ltd.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.switchStructureCheck = exports.arrayCheck = exports.numberCheck = exports.number = exports.stringCheck = exports.string = exports.boolean = exports.readFloat64 = exports.readFloat32 = exports.uint64 = exports.int64 = exports.float64 = exports.float32 = exports.uint32 = exports.int32 = exports.uint16 = exports.int16 = exports.uint8 = exports.int8 = void 0;
var spec_1 = require("../spec");
function utf8Read(bytes, offset, length) {
    var string = '', chr = 0;
    for (var i = offset, end = offset + length; i < end; i++) {
        var byte = bytes[i];
        if ((byte & 0x80) === 0x00) {
            string += String.fromCharCode(byte);
            continue;
        }
        if ((byte & 0xe0) === 0xc0) {
            string += String.fromCharCode(((byte & 0x1f) << 6) |
                (bytes[++i] & 0x3f));
            continue;
        }
        if ((byte & 0xf0) === 0xe0) {
            string += String.fromCharCode(((byte & 0x0f) << 12) |
                ((bytes[++i] & 0x3f) << 6) |
                ((bytes[++i] & 0x3f) << 0));
            continue;
        }
        if ((byte & 0xf8) === 0xf0) {
            chr = ((byte & 0x07) << 18) |
                ((bytes[++i] & 0x3f) << 12) |
                ((bytes[++i] & 0x3f) << 6) |
                ((bytes[++i] & 0x3f) << 0);
            if (chr >= 0x010000) { // surrogate pair
                chr -= 0x010000;
                string += String.fromCharCode((chr >>> 10) + 0xD800, (chr & 0x3FF) + 0xDC00);
            }
            else {
                string += String.fromCharCode(chr);
            }
            continue;
        }
        console.error('Invalid byte ' + byte.toString(16));
        // (do not throw error to avoid server/client from crashing due to hack attemps)
        // throw new Error('Invalid byte ' + byte.toString(16));
    }
    return string;
}
function int8(bytes, it) {
    return uint8(bytes, it) << 24 >> 24;
}
exports.int8 = int8;
;
function uint8(bytes, it) {
    return bytes[it.offset++];
}
exports.uint8 = uint8;
;
function int16(bytes, it) {
    return uint16(bytes, it) << 16 >> 16;
}
exports.int16 = int16;
;
function uint16(bytes, it) {
    return bytes[it.offset++] | bytes[it.offset++] << 8;
}
exports.uint16 = uint16;
;
function int32(bytes, it) {
    return bytes[it.offset++] | bytes[it.offset++] << 8 | bytes[it.offset++] << 16 | bytes[it.offset++] << 24;
}
exports.int32 = int32;
;
function uint32(bytes, it) {
    return int32(bytes, it) >>> 0;
}
exports.uint32 = uint32;
;
function float32(bytes, it) {
    return readFloat32(bytes, it);
}
exports.float32 = float32;
function float64(bytes, it) {
    return readFloat64(bytes, it);
}
exports.float64 = float64;
function int64(bytes, it) {
    var low = uint32(bytes, it);
    var high = int32(bytes, it) * Math.pow(2, 32);
    return high + low;
}
exports.int64 = int64;
;
function uint64(bytes, it) {
    var low = uint32(bytes, it);
    var high = uint32(bytes, it) * Math.pow(2, 32);
    return high + low;
}
exports.uint64 = uint64;
;
// force little endian to facilitate decoding on multiple implementations
var _isLittleEndian = true; // new Uint16Array(new Uint8Array([1, 0]).buffer)[0] === 1;
var _int32 = new Int32Array(2);
var _float32 = new Float32Array(_int32.buffer);
var _float64 = new Float64Array(_int32.buffer);
function readFloat32(bytes, it) {
    _int32[0] = int32(bytes, it);
    return _float32[0];
}
exports.readFloat32 = readFloat32;
;
function readFloat64(bytes, it) {
    _int32[_isLittleEndian ? 0 : 1] = int32(bytes, it);
    _int32[_isLittleEndian ? 1 : 0] = int32(bytes, it);
    return _float64[0];
}
exports.readFloat64 = readFloat64;
;
function boolean(bytes, it) {
    return uint8(bytes, it) > 0;
}
exports.boolean = boolean;
;
function string(bytes, it) {
    var prefix = bytes[it.offset++];
    var length;
    if (prefix < 0xc0) {
        // fixstr
        length = prefix & 0x1f;
    }
    else if (prefix === 0xd9) {
        length = uint8(bytes, it);
    }
    else if (prefix === 0xda) {
        length = uint16(bytes, it);
    }
    else if (prefix === 0xdb) {
        length = uint32(bytes, it);
    }
    var value = utf8Read(bytes, it.offset, length);
    it.offset += length;
    return value;
}
exports.string = string;
function stringCheck(bytes, it) {
    var prefix = bytes[it.offset];
    return (
    // fixstr
    (prefix < 0xc0 && prefix > 0xa0) ||
        // str 8
        prefix === 0xd9 ||
        // str 16
        prefix === 0xda ||
        // str 32
        prefix === 0xdb);
}
exports.stringCheck = stringCheck;
function number(bytes, it) {
    var prefix = bytes[it.offset++];
    if (prefix < 0x80) {
        // positive fixint
        return prefix;
    }
    else if (prefix === 0xca) {
        // float 32
        return readFloat32(bytes, it);
    }
    else if (prefix === 0xcb) {
        // float 64
        return readFloat64(bytes, it);
    }
    else if (prefix === 0xcc) {
        // uint 8
        return uint8(bytes, it);
    }
    else if (prefix === 0xcd) {
        // uint 16
        return uint16(bytes, it);
    }
    else if (prefix === 0xce) {
        // uint 32
        return uint32(bytes, it);
    }
    else if (prefix === 0xcf) {
        // uint 64
        return uint64(bytes, it);
    }
    else if (prefix === 0xd0) {
        // int 8
        return int8(bytes, it);
    }
    else if (prefix === 0xd1) {
        // int 16
        return int16(bytes, it);
    }
    else if (prefix === 0xd2) {
        // int 32
        return int32(bytes, it);
    }
    else if (prefix === 0xd3) {
        // int 64
        return int64(bytes, it);
    }
    else if (prefix > 0xdf) {
        // negative fixint
        return (0xff - prefix + 1) * -1;
    }
}
exports.number = number;
;
function numberCheck(bytes, it) {
    var prefix = bytes[it.offset];
    // positive fixint - 0x00 - 0x7f
    // float 32        - 0xca
    // float 64        - 0xcb
    // uint 8          - 0xcc
    // uint 16         - 0xcd
    // uint 32         - 0xce
    // uint 64         - 0xcf
    // int 8           - 0xd0
    // int 16          - 0xd1
    // int 32          - 0xd2
    // int 64          - 0xd3
    return (prefix < 0x80 ||
        (prefix >= 0xca && prefix <= 0xd3));
}
exports.numberCheck = numberCheck;
function arrayCheck(bytes, it) {
    return bytes[it.offset] < 0xa0;
    // const prefix = bytes[it.offset] ;
    // if (prefix < 0xa0) {
    //   return prefix;
    // // array
    // } else if (prefix === 0xdc) {
    //   it.offset += 2;
    // } else if (0xdd) {
    //   it.offset += 4;
    // }
    // return prefix;
}
exports.arrayCheck = arrayCheck;
function switchStructureCheck(bytes, it) {
    return (
    // previous byte should be `SWITCH_TO_STRUCTURE`
    bytes[it.offset - 1] === spec_1.SWITCH_TO_STRUCTURE &&
        // next byte should be a number
        (bytes[it.offset] < 0x80 || (bytes[it.offset] >= 0xca && bytes[it.offset] <= 0xd3)));
}
exports.switchStructureCheck = switchStructureCheck;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGVjb2RlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL2VuY29kaW5nL2RlY29kZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztHQXFCRzs7O0FBRUgsZ0NBQThDO0FBUzlDLFNBQVMsUUFBUSxDQUFDLEtBQUssRUFBRSxNQUFNLEVBQUUsTUFBTTtJQUNyQyxJQUFJLE1BQU0sR0FBRyxFQUFFLEVBQUUsR0FBRyxHQUFHLENBQUMsQ0FBQztJQUN6QixLQUFLLElBQUksQ0FBQyxHQUFHLE1BQU0sRUFBRSxHQUFHLEdBQUcsTUFBTSxHQUFHLE1BQU0sRUFBRSxDQUFDLEdBQUcsR0FBRyxFQUFFLENBQUMsRUFBRSxFQUFFO1FBQ3hELElBQUksSUFBSSxHQUFHLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUNwQixJQUFJLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQyxLQUFLLElBQUksRUFBRTtZQUMxQixNQUFNLElBQUksTUFBTSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUNwQyxTQUFTO1NBQ1Y7UUFDRCxJQUFJLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQyxLQUFLLElBQUksRUFBRTtZQUMxQixNQUFNLElBQUksTUFBTSxDQUFDLFlBQVksQ0FDM0IsQ0FBQyxDQUFDLElBQUksR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7Z0JBQ3BCLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLENBQ3BCLENBQUM7WUFDRixTQUFTO1NBQ1Y7UUFDRCxJQUFJLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQyxLQUFLLElBQUksRUFBRTtZQUMxQixNQUFNLElBQUksTUFBTSxDQUFDLFlBQVksQ0FDM0IsQ0FBQyxDQUFDLElBQUksR0FBRyxJQUFJLENBQUMsSUFBSSxFQUFFLENBQUM7Z0JBQ3JCLENBQUMsQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFD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QUFJLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQyxNQUFNLENBQUMsSUFBSSxJQUFJLElBQUksS0FBSyxDQUFDLEVBQUUsQ0FBQyxNQUFNLENBQUMsSUFBSSxJQUFJLENBQUMsQ0FBQyxDQUN0RixDQUFDO0FBQ0osQ0FBQztBQVBELG9EQU9DIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDb3B5cmlnaHQgKGMpIDIwMTggRW5kZWwgRHJleWVyXG4gKiBDb3B5cmlnaHQgKGMpIDIwMTQgSW9uIERyaXZlIFNvZnR3YXJlIEx0ZC5cbiAqXG4gKiBQZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYSBjb3B5XG4gKiBvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSBcIlNvZnR3YXJlXCIpLCB0byBkZWFsXG4gKiBpbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzXG4gKiB0byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsXG4gKiBjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXNcbiAqIGZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6XG4gKlxuICogVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWQgaW4gYWxsXG4gKiBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLlxuICpcbiAqIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCBcIkFTIElTXCIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1MgT1JcbiAqIElNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZLFxuICogRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVOVC4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFXG4gKiBBVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSXG4gKiBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORyBGUk9NLFxuICogT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgU09GVFdBUkUgT1IgVEhFIFVTRSBPUiBPVEhFUiBERUFMSU5HUyBJTiBUSEVcbiAqIFNPRlRXQVJFXG4gKi9cblxuaW1wb3J0IHsgU1dJVENIX1RPX1NUUlVDVFVSRSB9IGZyb20gXCIuLi9zcGVjXCI7XG5cbi8qKlxuICogbXNncGFjayBpbXBsZW1lbnRhdGlvbiBoaWdobHkgYmFzZWQgb24gbm90ZXBhY2suaW9cbiAqIGh0dHBzOi8vZ2l0aHViLmNvbS9kYXJyYWNoZXF1ZXNuZS9ub3RlcGFja1xuICovXG5cbmV4cG9ydCBpbnRlcmZhY2UgSXRlcmF0b3IgeyBvZmZzZXQ6IG51bWJlcjsgfVxuXG5mdW5jdGlvbiB1dGY4UmVhZChieXRlcywgb2Zmc2V0LCBsZW5ndGgpIHtcbiAgdmFyIHN0cmluZyA9ICcnLCBjaHIgPSAwO1xuICBmb3IgKHZhciBpID0gb2Zmc2V0LCBlbmQgPSBvZmZzZXQgKyBsZW5ndGg7IGkgPCBlbmQ7IGkrKykge1xuICAgIHZhciBieXRlID0gYnl0ZXNbaV07XG4gICAgaWYgKChieXRlICYgMHg4MCkgPT09IDB4MDApIHtcbiAgICAgIHN0cmluZyArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGJ5dGUpO1xuICAgICAgY29udGludWU7XG4gICAgfVxuICAgIGlmICgoYnl0ZSAmIDB4ZTApID09PSAweGMwKSB7XG4gICAgICBzdHJpbmcgKz0gU3RyaW5nLmZyb21DaGFyQ29kZShcbiAgICAgICAgKChieXRlICYgMHgxZikgPDwgNikgfFxuICAgICAgICAoYnl0ZXNbKytpXSAmIDB4M2YpXG4gICAgICApO1xuICAgICAgY29udGludWU7XG4gICAgfVxuICAgIGlmICgoYnl0ZSAmIDB4ZjApID09PSAweGUwKSB7XG4gICAgICBzdHJpbmcgKz0gU3RyaW5nLmZyb21DaGFyQ29kZShcbiAgICAgICAgKChieXRlICYgMHgwZikgPDwgMTIpIHxcbiAgICAgICAgKChieXRlc1srK2ldICYgMHgzZikgPDwgNikgfFxuICAgICAgICAoKGJ5dGVzWysraV0gJiAweDNmKSA8PCAwKVxuICAgICAgKTtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cbiAgICBpZiAoKGJ5dGUgJiAweGY4KSA9PT0gMHhmMCkge1xuICAgICAgY2hyID0gKChieXRlICYgMHgwNykgPDwgMTgpIHxcbiAgICAgICAgKChieXRlc1srK2ldICYgMHgzZikgPDwgMTIpIHxcbiAgICAgICAgKChieXRlc1srK2ldICYgMHgzZikgPDwgNikgfFxuICAgICAgICAoKGJ5dGVzWysraV0gJiAweDNmKSA8PCAwKTtcbiAgICAgIGlmIChjaHIgPj0gMHgwMTAwMDApIHsgLy8gc3Vycm9nYXRlIHBhaXJcbiAgICAgICAgY2hyIC09IDB4MDEwMDAwO1xuICAgICAgICBzdHJpbmcgKz0gU3RyaW5nLmZyb21DaGFyQ29kZSgoY2hyID4+PiAxMCkgKyAweEQ4MDAsIChjaHIgJiAweDNGRikgKyAweERDMDApO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgc3RyaW5nICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoY2hyKTtcbiAgICAgIH1cbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cblxuICAgIGNvbnNvbGUuZXJyb3IoJ0ludmFsaWQgYnl0ZSAnICsgYnl0ZS50b1N0cmluZygxNikpO1xuICAgIC8vIChkbyBub3QgdGhyb3cgZXJyb3IgdG8gYXZvaWQgc2VydmVyL2NsaWVudCBmcm9tIGNyYXNoaW5nIGR1ZSB0byBoYWNrIGF0dGVtcHMpXG4gICAgLy8gdGhyb3cgbmV3IEVycm9yKCdJbnZhbGlkIGJ5dGUgJyArIGJ5dGUudG9TdHJpbmcoMTYpKTtcbiAgfVxuICByZXR1cm4gc3RyaW5nO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gaW50OCAoYnl0ZXM6IG51bWJlcltdLCBpdDogSXRlcmF0b3IpIHtcbiAgICByZXR1cm4gdWludDgoYnl0ZXMsIGl0KSA8PCAyNCA+PiAyNDtcbn07XG5cbmV4cG9ydCBmdW5jdGlvbiB1aW50OCAoYnl0ZXM6IG51bWJlcltdLCBpdDogSXRlcmF0b3IpIHtcbiAgICByZXR1cm4gYnl0ZXNbaXQub2Zmc2V0KytdO1xufTtcblxuZXhwb3J0IGZ1bmN0aW9uIGludDE2IChieXRlczogbnVtYmVyW10sIGl0OiBJdGVyYXRvcikge1xuICAgIHJldHVybiB1aW50MTYoYnl0ZXMsIGl0KSA8PCAxNiA+PiAxNjtcbn07XG5cbmV4cG9ydCBmdW5jdGlvbiB1aW50MTYgKGJ5dGVzOiBudW1iZXJbXSwgaXQ6IEl0ZXJhdG9yKSB7XG4gICAgcmV0dXJuIGJ5dGVzW2l0Lm9mZnNldCsrXSB8IGJ5dGVzW2l0Lm9mZnNldCsrXSA8PCA4O1xufTtcblxuZXhwb3J0IGZ1bmN0aW9uIGludDMyIChieXRlczogbnVtYmVyW10sIGl0OiBJdGVyYXRvcikge1xuICAgIHJldHVybiBieXRlc1tpdC5vZmZzZXQrK10gfCBieXRlc1tpdC5vZmZzZXQrK10gPDwgOCB8IGJ5dGVzW2l0Lm9mZnNldCsrXSA8PCAxNiB8IGJ5dGVzW2l0Lm9mZnNldCsrXSA8PCAyNDtcbn07XG5cbmV4cG9ydCBmdW5jdGlvbiB1aW50MzIgKGJ5dGVzOiBudW1iZXJbXSwgaXQ6IEl0ZXJhdG9yKSB7XG4gICAgcmV0dXJuIGludDMyKGJ5dGVzLCBpdCkgPj4+IDA7XG59O1xuXG5leHBvcnQgZnVuY3Rpb24gZmxvYXQzMihieXRlczogbnVtYmVyW10sIGl0OiBJdGVyYXRvcikge1xuICByZXR1cm4gcmVhZEZsb2F0MzIoYnl0ZXMsIGl0KTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGZsb2F0NjQoYnl0ZXM6IG51bWJlcltdLCBpdDogSXRlcmF0b3IpIHtcbiAgcmV0dXJuIHJlYWRGbG9hdDY0KGJ5dGVzLCBpdCk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBpbnQ2NChieXRlczogbnVtYmVyW10sIGl0OiBJdGVyYXRvcikge1xuICBjb25zdCBsb3cgPSB1aW50MzIoYnl0ZXMsIGl0KTtcbiAgY29uc3QgaGlnaCA9IGludDMyKGJ5dGVzLCBpdCkgKiBNYXRoLnBvdygyLCAzMik7XG4gIHJldHVybiBoaWdoICsgbG93O1xufTtcblxuZXhwb3J0IGZ1bmN0aW9uIHVpbnQ2NChieXRlczogbnVtYmVyW10sIGl0OiBJdGVyYXRvcikge1xuICBjb25zdCBsb3cgPSB1aW50MzIoYnl0ZXMsIGl0KTtcbiAgY29uc3QgaGlnaCA9IHVpbnQzMihieXRlcywgaXQpICogTWF0aC5wb3coMiwgMzIpO1xuICByZXR1cm4gaGlnaCArIGxvdztcbn07XG5cbi8vIGZvcmNlIGxpdHRsZSBlbmRpYW4gdG8gZmFjaWxpdGF0ZSBkZWNvZGluZyBvbiBtdWx0aXBsZSBpbXBsZW1lbnRhdGlvbnNcbmNvbnN0IF9pc0xpdHRsZUVuZGlhbiA9IHRydWU7ICAvLyBuZXcgVWludDE2QXJyYXkobmV3IFVpbnQ4QXJyYXkoWzEsIDBdKS5idWZmZXIpWzBdID09PSAxO1xuY29uc3QgX2ludDMyID0gbmV3IEludDMyQXJyYXkoMik7XG5jb25zdCBfZmxvYXQzMiA9IG5ldyBGbG9hdDMyQXJyYXkoX2ludDMyLmJ1ZmZlcik7XG5jb25zdCBfZmxvYXQ2NCA9IG5ldyBGbG9hdDY0QXJyYXkoX2ludDMyLmJ1ZmZlcik7XG5cbmV4cG9ydCBmdW5jdGlvbiByZWFkRmxvYXQzMiAoYnl0ZXM6IG51bWJlcltdLCBpdDogSXRlcmF0b3IpIHtcbiAgICBfaW50MzJbMF0gPSBpbnQzMihieXRlcywgaXQpO1xuICAgIHJldHVybiBfZmxvYXQzMlswXTtcbn07XG5cbmV4cG9ydCBmdW5jdGlvbiByZWFkRmxvYXQ2NCAoYnl0ZXM6IG51bWJlcltdLCBpdDogSXRlcmF0b3IpIHtcbiAgICBfaW50MzJbX2lzTGl0dGxlRW5kaWFuID8gMCA6IDFdID0gaW50MzIoYnl0ZXMsIGl0KTtcbiAgICBfaW50MzJbX2lzTGl0dGxlRW5kaWFuID8gMSA6IDBdID0gaW50MzIoYnl0ZXMsIGl0KTtcbiAgICByZXR1cm4gX2Zsb2F0NjRbMF07XG59O1xuXG5leHBvcnQgZnVuY3Rpb24gYm9vbGVhbiAoYnl0ZXM6IG51bWJlcltdLCBpdDogSXRlcmF0b3IpIHtcbiAgICByZXR1cm4gdWludDgoYnl0ZXMsIGl0KSA+IDA7XG59O1xuXG5leHBvcnQgZnVuY3Rpb24gc3RyaW5nIChieXRlcywgaXQ6IEl0ZXJhdG9yKSB7XG4gIGNvbnN0IHByZWZpeCA9IGJ5dGVzW2l0Lm9mZnNldCsrXTtcbiAgbGV0IGxlbmd0aDogbnVtYmVyO1xuXG4gIGlmIChwcmVmaXggPCAweGMwKSB7XG4gICAgLy8gZml4c3RyXG4gICAgbGVuZ3RoID0gcHJlZml4ICYgMHgxZjtcblxuICB9IGVsc2UgaWYgKHByZWZpeCA9PT0gMHhkOSkge1xuICAgIGxlbmd0aCA9IHVpbnQ4KGJ5dGVzLCBpdCk7XG5cbiAgfSBlbHNlIGlmIChwcmVmaXggPT09IDB4ZGEpIHtcbiAgICBsZW5ndGggPSB1aW50MTYoYnl0ZXMsIGl0KTtcblxuICB9IGVsc2UgaWYgKHByZWZpeCA9PT0gMHhkYikge1xuICAgIGxlbmd0aCA9IHVpbnQzMihieXRlcywgaXQpO1xuICB9XG5cbiAgY29uc3QgdmFsdWUgPSB1dGY4UmVhZChieXRlcywgaXQub2Zmc2V0LCBsZW5ndGgpO1xuICBpdC5vZmZzZXQgKz0gbGVuZ3RoO1xuXG4gIHJldHVybiB2YWx1ZTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHN0cmluZ0NoZWNrKGJ5dGVzLCBpdDogSXRlcmF0b3IpIHtcbiAgY29uc3QgcHJlZml4ID0gYnl0ZXNbaXQub2Zmc2V0XTtcbiAgcmV0dXJuIChcbiAgICAvLyBmaXhzdHJcbiAgICAocHJlZml4IDwgMHhjMCAmJiBwcmVmaXggPiAweGEwKSB8fFxuICAgIC8vIHN0ciA4XG4gICAgcHJlZml4ID09PSAweGQ5IHx8XG4gICAgLy8gc3RyIDE2XG4gICAgcHJlZml4ID09PSAweGRhIHx8XG4gICAgLy8gc3RyIDMyXG4gICAgcHJlZml4ID09PSAweGRiXG4gICk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBudW1iZXIgKGJ5dGVzLCBpdDogSXRlcmF0b3IpIHtcbiAgY29uc3QgcHJlZml4ID0gYnl0ZXNbaXQub2Zmc2V0KytdO1xuXG4gIGlmIChwcmVmaXggPCAweDgwKSB7XG4gICAgLy8gcG9zaXRpdmUgZml4aW50XG4gICAgcmV0dXJuIHByZWZpeDtcblxuICB9IGVsc2UgaWYgKHByZWZpeCA9PT0gMHhjYSkge1xuICAgIC8vIGZsb2F0IDMyXG4gICAgcmV0dXJuIHJlYWRGbG9hdDMyKGJ5dGVzLCBpdCk7XG5cbiAgfSBlbHNlIGlmIChwcmVmaXggPT09IDB4Y2IpIHtcbiAgICAvLyBmbG9hdCA2NFxuICAgIHJldHVybiByZWFkRmxvYXQ2NChieXRlcywgaXQpO1xuXG4gIH0gZWxzZSBpZiAocHJlZml4ID09PSAweGNjKSB7XG4gICAgLy8gdWludCA4XG4gICAgcmV0dXJuIHVpbnQ4KGJ5dGVzLCBpdCk7XG5cbiAgfSBlbHNlIGlmIChwcmVmaXggPT09IDB4Y2QpIHtcbiAgICAvLyB1aW50IDE2XG4gICAgcmV0dXJuIHVpbnQxNihieXRlcywgaXQpO1xuXG4gIH0gZWxzZSBpZiAocHJlZml4ID09PSAweGNlKSB7XG4gICAgLy8gdWludCAzMlxuICAgIHJldHVybiB1aW50MzIoYnl0ZXMsIGl0KTtcblxuICB9IGVsc2UgaWYgKHByZWZpeCA9PT0gMHhjZikge1xuICAgIC8vIHVpbnQgNjRcbiAgICByZXR1cm4gdWludDY0KGJ5dGVzLCBpdCk7XG5cbiAgfSBlbHNlIGlmIChwcmVmaXggPT09IDB4ZDApIHtcbiAgICAvLyBpbnQgOFxuICAgIHJldHVybiBpbnQ4KGJ5dGVzLCBpdCk7XG5cbiAgfSBlbHNlIGlmIChwcmVmaXggPT09IDB4ZDEpIHtcbiAgICAvLyBpbnQgMTZcbiAgICByZXR1cm4gaW50MTYoYnl0ZXMsIGl0KTtcblxuICB9IGVsc2UgaWYgKHByZWZpeCA9PT0gMHhkMikge1xuICAgIC8vIGludCAzMlxuICAgIHJldHVybiBpbnQzMihieXRlcywgaXQpO1xuXG4gIH0gZWxzZSBpZiAocHJlZml4ID09PSAweGQzKSB7XG4gICAgLy8gaW50IDY0XG4gICAgcmV0dXJuIGludDY0KGJ5dGVzLCBpdCk7XG5cbiAgfSBlbHNlIGlmIChwcmVmaXggPiAweGRmKSB7XG4gICAgLy8gbmVnYXRpdmUgZml4aW50XG4gICAgcmV0dXJuICgweGZmIC0gcHJlZml4ICsgMSkgKiAtMVxuICB9XG59O1xuXG5leHBvcnQgZnVuY3Rpb24gbnVtYmVyQ2hlY2sgKGJ5dGVzLCBpdDogSXRlcmF0b3IpIHtcbiAgY29uc3QgcHJlZml4ID0gYnl0ZXNbaXQub2Zmc2V0XTtcbiAgLy8gcG9zaXRpdmUgZml4aW50IC0gMHgwMCAtIDB4N2ZcbiAgLy8gZmxvYXQgMzIgICAgICAgIC0gMHhjYVxuICAvLyBmbG9hdCA2NCAgICAgICAgLSAweGNiXG4gIC8vIHVpbnQgOCAgICAgICAgICAtIDB4Y2NcbiAgLy8gdWludCAxNiAgICAgICAgIC0gMHhjZFxuICAvLyB1aW50IDMyICAgICAgICAgLSAweGNlXG4gIC8vIHVpbnQgNjQgICAgICAgICAtIDB4Y2ZcbiAgLy8gaW50IDggICAgICAgICAgIC0gMHhkMFxuICAvLyBpbnQgMTYgICAgICAgICAgLSAweGQxXG4gIC8vIGludCAzMiAgICAgICAgICAtIDB4ZDJcbiAgLy8gaW50IDY0ICAgICAgICAgIC0gMHhkM1xuICByZXR1cm4gKFxuICAgIHByZWZpeCA8IDB4ODAgfHxcbiAgICAocHJlZml4ID49IDB4Y2EgJiYgcHJlZml4IDw9IDB4ZDMpXG4gICk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBhcnJheUNoZWNrIChieXRlcywgaXQ6IEl0ZXJhdG9yKSB7XG4gIHJldHVybiBieXRlc1tpdC5vZmZzZXRdIDwgMHhhMDtcblxuICAvLyBjb25zdCBwcmVmaXggPSBieXRlc1tpdC5vZmZzZXRdIDtcblxuICAvLyBpZiAocHJlZml4IDwgMHhhMCkge1xuICAvLyAgIHJldHVybiBwcmVmaXg7XG5cbiAgLy8gLy8gYXJyYXlcbiAgLy8gfSBlbHNlIGlmIChwcmVmaXggPT09IDB4ZGMpIHtcbiAgLy8gICBpdC5vZmZzZXQgKz0gMjtcblxuICAvLyB9IGVsc2UgaWYgKDB4ZGQpIHtcbiAgLy8gICBpdC5vZmZzZXQgKz0gNDtcbiAgLy8gfVxuXG4gIC8vIHJldHVybiBwcmVmaXg7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBzd2l0Y2hTdHJ1Y3R1cmVDaGVjayhieXRlcywgaXQ6IEl0ZXJhdG9yKSB7XG4gIHJldHVybiAoXG4gICAgICAvLyBwcmV2aW91cyBieXRlIHNob3VsZCBiZSBgU1dJVENIX1RPX1NUUlVDVFVSRWBcbiAgICAgIGJ5dGVzW2l0Lm9mZnNldCAtIDFdID09PSBTV0lUQ0hfVE9fU1RSVUNUVVJFICYmXG4gICAgICAvLyBuZXh0IGJ5dGUgc2hvdWxkIGJlIGEgbnVtYmVyXG4gICAgICAoYnl0ZXNbaXQub2Zmc2V0XSA8IDB4ODAgfHwgKGJ5dGVzW2l0Lm9mZnNldF0gPj0gMHhjYSAmJiBieXRlc1tpdC5vZmZzZXRdIDw9IDB4ZDMpKVxuICApO1xufSJdfQ==