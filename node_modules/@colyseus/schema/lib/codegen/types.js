"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.getInheritanceTree = exports.Property = exports.Class = exports.Interface = exports.Context = exports.getCommentHeader = void 0;
var fs = require("fs");
var VERSION = JSON.parse(fs.readFileSync(__dirname + "/../../package.json").toString()).version;
var COMMENT_HEADER = "\nTHIS FILE HAS BEEN GENERATED AUTOMATICALLY\nDO NOT CHANGE IT MANUALLY UNLESS YOU KNOW WHAT YOU'RE DOING\n\nGENERATED USING @colyseus/schema " + VERSION + "\n";
function getCommentHeader(singleLineComment) {
    if (singleLineComment === void 0) { singleLineComment = "//"; }
    return "" + COMMENT_HEADER.split("\n").map(function (line) { return singleLineComment + " " + line; }).join("\n");
}
exports.getCommentHeader = getCommentHeader;
var Context = /** @class */ (function () {
    function Context() {
        this.classes = [];
        this.interfaces = [];
    }
    Context.prototype.getStructures = function () {
        var _this = this;
        return {
            classes: this.classes.filter(function (klass) {
                if (_this.isSchemaClass(klass)) {
                    return true;
                }
                else {
                    var parentClass = klass;
                    while (parentClass = _this.getParentClass(parentClass)) {
                        if (_this.isSchemaClass(parentClass)) {
                            return true;
                        }
                    }
                }
                return false;
            }),
            interfaces: this.interfaces,
        };
    };
    Context.prototype.addStructure = function (structure) {
        structure.context = this;
        if (structure instanceof Class) {
            this.classes.push(structure);
        }
        else if (structure instanceof Interface) {
            this.interfaces.push(structure);
        }
    };
    Context.prototype.getParentClass = function (klass) {
        return this.classes.find(function (c) { return c.name === klass.extends; });
    };
    Context.prototype.isSchemaClass = function (klass) {
        var isSchema = false;
        var currentClass = klass;
        while (!isSchema && currentClass) {
            isSchema = currentClass.extends === "Schema";
            currentClass = this.getParentClass(currentClass);
        }
        return isSchema;
    };
    return Context;
}());
exports.Context = Context;
var Interface = /** @class */ (function () {
    function Interface() {
        this.properties = [];
    }
    Interface.prototype.addProperty = function (property) {
        this.properties.push(property);
    };
    return Interface;
}());
exports.Interface = Interface;
var Class = /** @class */ (function () {
    function Class() {
        this.properties = [];
    }
    Class.prototype.addProperty = function (property) {
        property.index = this.properties.length;
        this.properties.push(property);
    };
    Class.prototype.postProcessing = function () {
        /**
         * Ensure the proprierties `index` are correct using inheritance
         */
        var parentKlass = this;
        while (parentKlass &&
            (parentKlass = this.context.classes.find(function (k) { return k.name === parentKlass.extends; }))) {
            this.properties.forEach(function (prop) {
                prop.index += parentKlass.properties.length;
            });
        }
    };
    return Class;
}());
exports.Class = Class;
var Property = /** @class */ (function () {
    function Property() {
    }
    return Property;
}());
exports.Property = Property;
function getInheritanceTree(klass, allClasses, includeSelf) {
    if (includeSelf === void 0) { includeSelf = true; }
    var currentClass = klass;
    var inheritanceTree = [];
    if (includeSelf) {
        inheritanceTree.push(currentClass);
    }
    while (currentClass.extends !== "Schema") {
        currentClass = allClasses.find(function (klass) { return klass.name == currentClass.extends; });
        inheritanceTree.push(currentClass);
    }
    return inheritanceTree;
}
exports.getInheritanceTree = getInheritanceTree;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidHlwZXMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvY29kZWdlbi90eXBlcy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFBQSx1QkFBeUI7QUFFekIsSUFBTSxPQUFPLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUMsWUFBWSxDQUFDLFNBQVMsR0FBRyxxQkFBcUIsQ0FBQyxDQUFDLFFBQVEsRUFBRSxDQUFDLENBQUMsT0FBTyxDQUFDO0FBQ2xHLElBQU0sY0FBYyxHQUFHLG1KQUlZLE9BQU8sT0FDekMsQ0FBQztBQUVGLFNBQWdCLGdCQUFnQixDQUFDLGlCQUFnQztJQUFoQyxrQ0FBQSxFQUFBLHdCQUFnQztJQUM3RCxPQUFPLEtBQUcsY0FBYyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQyxHQUFHLENBQUMsVUFBQSxJQUFJLElBQUksT0FBRyxpQkFBaUIsU0FBSSxJQUFNLEVBQTlCLENBQThCLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFHLENBQUM7QUFDbEcsQ0FBQztBQUZELDRDQUVDO0FBRUQ7SUFBQTtRQUNJLFlBQU8sR0FBWSxFQUFFLENBQUM7UUFDdEIsZUFBVSxHQUFnQixFQUFFLENBQUM7SUErQ2pDLENBQUM7SUE3Q0csK0JBQWEsR0FBYjtRQUFBLGlCQWlCQztRQWhCRyxPQUFPO1lBQ0gsT0FBTyxFQUFFLElBQUksQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLFVBQUEsS0FBSztnQkFDOUIsSUFBSSxLQUFJLENBQUMsYUFBYSxDQUFDLEtBQUssQ0FBQyxFQUFFO29CQUMzQixPQUFPLElBQUksQ0FBQztpQkFDZjtxQkFBTTtvQkFDSCxJQUFJLFdBQVcsR0FBRyxLQUFLLENBQUM7b0JBQ3hCLE9BQU8sV0FBVyxHQUFHLEtBQUksQ0FBQyxjQUFjLENBQUMsV0FBVyxDQUFDLEVBQUU7d0JBQ25ELElBQUksS0FBSSxDQUFDLGFBQWEsQ0FBQyxXQUFXLENBQUMsRUFBRTs0QkFDakMsT0FBTyxJQUFJLENBQUM7eUJBQ2Y7cUJBQ0o7aUJBQ0o7Z0JBQ0QsT0FBTyxLQUFLLENBQUM7WUFDakIsQ0FBQyxDQUFDO1lBQ0YsVUFBVSxFQUFFLElBQUksQ0FBQyxVQUFVO1NBQzlCLENBQUM7SUFDTixDQUFDO0lBRUQsOEJBQVksR0FBWixVQUFhLFNBQXFCO1FBQzlCLFNBQVMsQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDO1FBRXpCLElBQUksU0FBUyxZQUFZLEtBQUssRUFBRTtZQUM1QixJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQztTQUVoQzthQUFNLElBQUksU0FBUyxZQUFZLFNBQVMsRUFBRTtZQUN2QyxJQUFJLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQztTQUNuQztJQUNMLENBQUM7SUFFTyxnQ0FBYyxHQUF0QixVQUF1QixLQUFZO1FBQy9CLE9BQU8sSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsVUFBQSxDQUFDLElBQUksT0FBQSxDQUFDLENBQUMsSUFBSSxLQUFLLEtBQUssQ0FBQyxPQUFPLEVBQXhCLENBQXdCLENBQUMsQ0FBQztJQUM1RCxDQUFDO0lBRU8sK0JBQWEsR0FBckIsVUFBc0IsS0FBWTtRQUM5QixJQUFJLFFBQVEsR0FBWSxLQUFLLENBQUM7UUFFOUIsSUFBSSxZQUFZLEdBQUcsS0FBSyxDQUFDO1FBQ3pCLE9BQU8sQ0FBQyxRQUFRLElBQUksWUFBWSxFQUFFO1lBQzlCLFFBQVEsR0FBRyxZQUFZLENBQUMsT0FBTyxLQUFLLFFBQVEsQ0FBQztZQUM3QyxZQUFZLEdBQUcsSUFBSSxDQUFDLGNBQWMsQ0FBQyxZQUFZLENBQUMsQ0FBQztTQUNwRDtRQUVELE9BQU8sUUFBUSxDQUFBO0lBQ25CLENBQUM7SUFDTCxjQUFDO0FBQUQsQ0FBQyxBQWpERCxJQWlEQztBQWpEWSwwQkFBTztBQTBEcEI7SUFBQTtRQUdJLGVBQVUsR0FBZSxFQUFFLENBQUM7SUFLaEMsQ0FBQztJQUhHLCtCQUFXLEdBQVgsVUFBWSxRQUFrQjtRQUMxQixJQUFJLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztJQUNuQyxDQUFDO0lBQ0wsZ0JBQUM7QUFBRCxDQUFDLEFBUkQsSUFRQztBQVJZLDhCQUFTO0FBVXRCO0lBQUE7UUFHSSxlQUFVLEdBQWUsRUFBRSxDQUFDO0lBdUJoQyxDQUFDO0lBcEJHLDJCQUFXLEdBQVgsVUFBWSxRQUFrQjtRQUMxQixRQUFRLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUMsTUFBTSxDQUFDO1FBQ3hDLElBQUksQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO0lBQ25DLENBQUM7SUFFRCw4QkFBYyxHQUFkO1FBQ0k7O1dBRUc7UUFDSCxJQUFJLFdBQVcsR0FBVSxJQUFJLENBQUM7UUFFOUIsT0FDSSxXQUFXO1lBQ1gsQ0FBQyxXQUFXLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLFVBQUEsQ0FBQyxJQUFJLE9BQUEsQ0FBQyxDQUFDLElBQUksS0FBSyxXQUFXLENBQUMsT0FBTyxFQUE5QixDQUE4QixDQUFDLENBQUMsRUFDaEY7WUFDRSxJQUFJLENBQUMsVUFBVSxDQUFDLE9BQU8sQ0FBQyxVQUFBLElBQUk7Z0JBQ3hCLElBQUksQ0FBQyxLQUFLLElBQUksV0FBVyxDQUFDLFVBQVUsQ0FBQyxNQUFNLENBQUM7WUFDaEQsQ0FBQyxDQUFDLENBQUM7U0FDTjtJQUNMLENBQUM7SUFDTCxZQUFDO0FBQUQsQ0FBQyxBQTFCRCxJQTBCQztBQTFCWSxzQkFBSztBQTRCbEI7SUFBQTtJQU1BLENBQUM7SUFBRCxlQUFDO0FBQUQsQ0FBQyxBQU5ELElBTUM7QUFOWSw0QkFBUTtBQWFyQixTQUFnQixrQkFBa0IsQ0FBQyxLQUFZLEVBQUUsVUFBbUIsRUFBRSxXQUEyQjtJQUEzQiw0QkFBQSxFQUFBLGtCQUEyQjtJQUM3RixJQUFJLFlBQVksR0FBRyxLQUFLLENBQUM7SUFDekIsSUFBSSxlQUFlLEdBQVksRUFBRSxDQUFDO0lBRWxDLElBQUksV0FBVyxFQUFFO1FBQ2IsZUFBZSxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQztLQUN0QztJQUVELE9BQU8sWUFBWSxDQUFDLE9BQU8sS0FBSyxRQUFRLEVBQUU7UUFDdEMsWUFBWSxHQUFHLFVBQVUsQ0FBQyxJQUFJLENBQUMsVUFBQSxLQUFLLElBQUksT0FBQSxLQUFLLENBQUMsSUFBSSxJQUFJLFlBQVksQ0FBQyxPQUFPLEVBQWxDLENBQWtDLENBQUMsQ0FBQztRQUM1RSxlQUFlLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDO0tBQ3RDO0lBRUQsT0FBTyxlQUFlLENBQUM7QUFDM0IsQ0FBQztBQWRELGdEQWNDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgZnMgZnJvbSBcImZzXCI7XG5cbmNvbnN0IFZFUlNJT04gPSBKU09OLnBhcnNlKGZzLnJlYWRGaWxlU3luYyhfX2Rpcm5hbWUgKyBcIi8uLi8uLi9wYWNrYWdlLmpzb25cIikudG9TdHJpbmcoKSkudmVyc2lvbjtcbmNvbnN0IENPTU1FTlRfSEVBREVSID0gYFxuVEhJUyBGSUxFIEhBUyBCRUVOIEdFTkVSQVRFRCBBVVRPTUFUSUNBTExZXG5ETyBOT1QgQ0hBTkdFIElUIE1BTlVBTExZIFVOTEVTUyBZT1UgS05PVyBXSEFUIFlPVSdSRSBET0lOR1xuXG5HRU5FUkFURUQgVVNJTkcgQGNvbHlzZXVzL3NjaGVtYSAke1ZFUlNJT059XG5gO1xuXG5leHBvcnQgZnVuY3Rpb24gZ2V0Q29tbWVudEhlYWRlcihzaW5nbGVMaW5lQ29tbWVudDogc3RyaW5nID0gXCIvL1wiKSB7XG4gICAgcmV0dXJuIGAke0NPTU1FTlRfSEVBREVSLnNwbGl0KFwiXFxuXCIpLm1hcChsaW5lID0+IGAke3NpbmdsZUxpbmVDb21tZW50fSAke2xpbmV9YCkuam9pbihcIlxcblwiKX1gO1xufVxuXG5leHBvcnQgY2xhc3MgQ29udGV4dCB7XG4gICAgY2xhc3NlczogQ2xhc3NbXSA9IFtdO1xuICAgIGludGVyZmFjZXM6IEludGVyZmFjZVtdID0gW107XG5cbiAgICBnZXRTdHJ1Y3R1cmVzKCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgY2xhc3NlczogdGhpcy5jbGFzc2VzLmZpbHRlcihrbGFzcyA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaXNTY2hlbWFDbGFzcyhrbGFzcykpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgbGV0IHBhcmVudENsYXNzID0ga2xhc3M7XG4gICAgICAgICAgICAgICAgICAgIHdoaWxlIChwYXJlbnRDbGFzcyA9IHRoaXMuZ2V0UGFyZW50Q2xhc3MocGFyZW50Q2xhc3MpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5pc1NjaGVtYUNsYXNzKHBhcmVudENsYXNzKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgaW50ZXJmYWNlczogdGhpcy5pbnRlcmZhY2VzLFxuICAgICAgICB9O1xuICAgIH1cblxuICAgIGFkZFN0cnVjdHVyZShzdHJ1Y3R1cmU6IElTdHJ1Y3R1cmUpIHtcbiAgICAgICAgc3RydWN0dXJlLmNvbnRleHQgPSB0aGlzO1xuXG4gICAgICAgIGlmIChzdHJ1Y3R1cmUgaW5zdGFuY2VvZiBDbGFzcykge1xuICAgICAgICAgICAgdGhpcy5jbGFzc2VzLnB1c2goc3RydWN0dXJlKTtcblxuICAgICAgICB9IGVsc2UgaWYgKHN0cnVjdHVyZSBpbnN0YW5jZW9mIEludGVyZmFjZSkge1xuICAgICAgICAgICAgdGhpcy5pbnRlcmZhY2VzLnB1c2goc3RydWN0dXJlKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgZ2V0UGFyZW50Q2xhc3Moa2xhc3M6IENsYXNzKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmNsYXNzZXMuZmluZChjID0+IGMubmFtZSA9PT0ga2xhc3MuZXh0ZW5kcyk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBpc1NjaGVtYUNsYXNzKGtsYXNzOiBDbGFzcykge1xuICAgICAgICBsZXQgaXNTY2hlbWE6IGJvb2xlYW4gPSBmYWxzZTtcblxuICAgICAgICBsZXQgY3VycmVudENsYXNzID0ga2xhc3M7XG4gICAgICAgIHdoaWxlICghaXNTY2hlbWEgJiYgY3VycmVudENsYXNzKSB7XG4gICAgICAgICAgICBpc1NjaGVtYSA9IGN1cnJlbnRDbGFzcy5leHRlbmRzID09PSBcIlNjaGVtYVwiO1xuICAgICAgICAgICAgY3VycmVudENsYXNzID0gdGhpcy5nZXRQYXJlbnRDbGFzcyhjdXJyZW50Q2xhc3MpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGlzU2NoZW1hXG4gICAgfVxufVxuXG5leHBvcnQgaW50ZXJmYWNlIElTdHJ1Y3R1cmUge1xuICAgIGNvbnRleHQ6IENvbnRleHQ7XG4gICAgbmFtZTogc3RyaW5nO1xuICAgIHByb3BlcnRpZXM6IFByb3BlcnR5W107XG4gICAgYWRkUHJvcGVydHkocHJvcGVydHk6IFByb3BlcnR5KTtcbn1cblxuZXhwb3J0IGNsYXNzIEludGVyZmFjZSBpbXBsZW1lbnRzIElTdHJ1Y3R1cmUge1xuICAgIGNvbnRleHQ6IENvbnRleHQ7XG4gICAgbmFtZTogc3RyaW5nO1xuICAgIHByb3BlcnRpZXM6IFByb3BlcnR5W10gPSBbXTtcblxuICAgIGFkZFByb3BlcnR5KHByb3BlcnR5OiBQcm9wZXJ0eSkge1xuICAgICAgICB0aGlzLnByb3BlcnRpZXMucHVzaChwcm9wZXJ0eSk7XG4gICAgfVxufVxuXG5leHBvcnQgY2xhc3MgQ2xhc3MgaW1wbGVtZW50cyBJU3RydWN0dXJlIHtcbiAgICBjb250ZXh0OiBDb250ZXh0O1xuICAgIG5hbWU6IHN0cmluZztcbiAgICBwcm9wZXJ0aWVzOiBQcm9wZXJ0eVtdID0gW107XG4gICAgZXh0ZW5kczogc3RyaW5nO1xuXG4gICAgYWRkUHJvcGVydHkocHJvcGVydHk6IFByb3BlcnR5KSB7XG4gICAgICAgIHByb3BlcnR5LmluZGV4ID0gdGhpcy5wcm9wZXJ0aWVzLmxlbmd0aDtcbiAgICAgICAgdGhpcy5wcm9wZXJ0aWVzLnB1c2gocHJvcGVydHkpO1xuICAgIH1cblxuICAgIHBvc3RQcm9jZXNzaW5nKCkge1xuICAgICAgICAvKipcbiAgICAgICAgICogRW5zdXJlIHRoZSBwcm9wcmllcnRpZXMgYGluZGV4YCBhcmUgY29ycmVjdCB1c2luZyBpbmhlcml0YW5jZVxuICAgICAgICAgKi9cbiAgICAgICAgbGV0IHBhcmVudEtsYXNzOiBDbGFzcyA9IHRoaXM7XG5cbiAgICAgICAgd2hpbGUgKFxuICAgICAgICAgICAgcGFyZW50S2xhc3MgJiZcbiAgICAgICAgICAgIChwYXJlbnRLbGFzcyA9IHRoaXMuY29udGV4dC5jbGFzc2VzLmZpbmQoayA9PiBrLm5hbWUgPT09IHBhcmVudEtsYXNzLmV4dGVuZHMpKVxuICAgICAgICApIHtcbiAgICAgICAgICAgIHRoaXMucHJvcGVydGllcy5mb3JFYWNoKHByb3AgPT4ge1xuICAgICAgICAgICAgICAgIHByb3AuaW5kZXggKz0gcGFyZW50S2xhc3MucHJvcGVydGllcy5sZW5ndGg7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cbn1cblxuZXhwb3J0IGNsYXNzIFByb3BlcnR5IHtcbiAgICBpbmRleDogbnVtYmVyO1xuICAgIG5hbWU6IHN0cmluZztcbiAgICB0eXBlOiBzdHJpbmc7XG4gICAgY2hpbGRUeXBlOiBzdHJpbmc7XG4gICAgZGVwcmVjYXRlZD86IGJvb2xlYW47XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgRmlsZSB7XG4gICAgbmFtZTogc3RyaW5nXG4gICAgY29udGVudDogc3RyaW5nO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0SW5oZXJpdGFuY2VUcmVlKGtsYXNzOiBDbGFzcywgYWxsQ2xhc3NlczogQ2xhc3NbXSwgaW5jbHVkZVNlbGY6IGJvb2xlYW4gPSB0cnVlKSB7XG4gICAgbGV0IGN1cnJlbnRDbGFzcyA9IGtsYXNzO1xuICAgIGxldCBpbmhlcml0YW5jZVRyZWU6IENsYXNzW10gPSBbXTtcblxuICAgIGlmIChpbmNsdWRlU2VsZikge1xuICAgICAgICBpbmhlcml0YW5jZVRyZWUucHVzaChjdXJyZW50Q2xhc3MpO1xuICAgIH1cblxuICAgIHdoaWxlIChjdXJyZW50Q2xhc3MuZXh0ZW5kcyAhPT0gXCJTY2hlbWFcIikge1xuICAgICAgICBjdXJyZW50Q2xhc3MgPSBhbGxDbGFzc2VzLmZpbmQoa2xhc3MgPT4ga2xhc3MubmFtZSA9PSBjdXJyZW50Q2xhc3MuZXh0ZW5kcyk7XG4gICAgICAgIGluaGVyaXRhbmNlVHJlZS5wdXNoKGN1cnJlbnRDbGFzcyk7XG4gICAgfVxuXG4gICAgcmV0dXJuIGluaGVyaXRhbmNlVHJlZTtcbn1cbiJdfQ==