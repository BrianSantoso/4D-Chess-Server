"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.generate = void 0;
var types_1 = require("../types");
var typeMaps = {
    "string": "String",
    "number": "Dynamic",
    "boolean": "Bool",
    "int8": "Int",
    "uint8": "UInt",
    "int16": "Int",
    "uint16": "UInt",
    "int32": "Int",
    "uint32": "UInt",
    "int64": "Int",
    "uint64": "UInt",
    "float32": "Float",
    "float64": "Float",
};
var typeInitializer = {
    "string": '""',
    "number": "0",
    "boolean": "false",
    "int8": "0",
    "uint8": "0",
    "int16": "0",
    "uint16": "0",
    "int32": "0",
    "uint32": "0",
    "int64": "0",
    "uint64": "0",
    "float32": "0",
    "float64": "0",
};
function generate(context, options) {
    return context.classes.map(function (klass) { return ({
        name: klass.name + ".hx",
        content: generateClass(klass, options.namespace, context.classes)
    }); });
}
exports.generate = generate;
function getInheritanceTree(klass, allClasses, includeSelf) {
    if (includeSelf === void 0) { includeSelf = true; }
    var currentClass = klass;
    var inheritanceTree = [];
    if (includeSelf) {
        inheritanceTree.push(currentClass);
    }
    while (currentClass.extends !== "Schema") {
        currentClass = allClasses.find(function (klass) { return klass.name == currentClass.extends; });
        inheritanceTree.push(currentClass);
    }
    return inheritanceTree;
}
function generateClass(klass, namespace, allClasses) {
    return types_1.getCommentHeader() + "\n\n" + (namespace ? "package " + namespace + ";" : "") + "\nimport io.colyseus.serializer.schema.Schema;\nimport io.colyseus.serializer.schema.types.*;\n\nclass " + klass.name + " extends " + klass.extends + " {\n" + klass.properties.map(function (prop) { return generateProperty(prop); }).join("\n") + "\n}\n";
}
function generateProperty(prop) {
    var langType;
    var initializer = "";
    var typeArgs = "\"" + prop.type + "\"";
    if (prop.childType) {
        var isUpcaseFirst = prop.childType.match(/^[A-Z]/);
        if (isUpcaseFirst) {
            typeArgs += ", " + prop.childType;
        }
        else {
            typeArgs += ", \"" + prop.childType + "\"";
        }
        if (prop.type === "ref") {
            langType = "" + prop.childType;
            initializer = "new " + prop.childType + "()";
        }
        else if (prop.type === "array") {
            langType = (isUpcaseFirst)
                ? "ArraySchema<" + prop.childType + ">"
                : "ArraySchema<" + typeMaps[prop.childType] + ">";
            initializer = "new " + langType + "()";
        }
        else if (prop.type === "map") {
            langType = (isUpcaseFirst)
                ? "MapSchema<" + prop.childType + ">"
                : "MapSchema<" + typeMaps[prop.childType] + ">";
            initializer = "new " + langType + "()";
        }
    }
    else {
        langType = typeMaps[prop.type];
        initializer = typeInitializer[prop.type];
    }
    return "\t@:type(" + typeArgs + ")\n\tpublic var " + prop.name + ": " + langType + " = " + initializer + ";\n";
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaGF4ZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9jb2RlZ2VuL2xhbmd1YWdlcy9oYXhlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUFBLGtDQUE0RTtBQUc1RSxJQUFNLFFBQVEsR0FBRztJQUNiLFFBQVEsRUFBRSxRQUFRO0lBQ2xCLFFBQVEsRUFBRSxTQUFTO0lBQ25CLFNBQVMsRUFBRSxNQUFNO0lBQ2pCLE1BQU0sRUFBRSxLQUFLO0lBQ2IsT0FBTyxFQUFFLE1BQU07SUFDZixPQUFPLEVBQUUsS0FBSztJQUNkLFFBQVEsRUFBRSxNQUFNO0lBQ2hCLE9BQU8sRUFBRSxLQUFLO0lBQ2QsUUFBUSxFQUFFLE1BQU07SUFDaEIsT0FBTyxFQUFFLEtBQUs7SUFDZCxRQUFRLEVBQUUsTUFBTTtJQUNoQixTQUFTLEVBQUUsT0FBTztJQUNsQixTQUFTLEVBQUUsT0FBTztDQUNyQixDQUFBO0FBRUQsSUFBTSxlQUFlLEdBQUc7SUFDcEIsUUFBUSxFQUFFLElBQUk7SUFDZCxRQUFRLEVBQUUsR0FBRztJQUNiLFNBQVMsRUFBRSxPQUFPO0lBQ2xCLE1BQU0sRUFBRSxHQUFHO0lBQ1gsT0FBTyxFQUFFLEdBQUc7SUFDWixPQUFPLEVBQUUsR0FBRztJQUNaLFFBQVEsRUFBRSxHQUFHO0lBQ2IsT0FBTyxFQUFFLEdBQUc7SUFDWixRQUFRLEVBQUUsR0FBRztJQUNiLE9BQU8sRUFBRSxHQUFHO0lBQ1osUUFBUSxFQUFFLEdBQUc7SUFDYixTQUFTLEVBQUUsR0FBRztJQUNkLFNBQVMsRUFBRSxHQUFHO0NBQ2pCLENBQUE7QUFFRCxTQUFnQixRQUFRLENBQUUsT0FBZ0IsRUFBRSxPQUF3QjtJQUNoRSxPQUFPLE9BQU8sQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLFVBQUEsS0FBSyxJQUFJLE9BQUEsQ0FBQztRQUNqQyxJQUFJLEVBQUUsS0FBSyxDQUFDLElBQUksR0FBRyxLQUFLO1FBQ3hCLE9BQU8sRUFBRSxhQUFhLENBQUMs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USxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUMvQixXQUFXLEdBQUcsZUFBZSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztLQUM1QztJQUVELE9BQU8sY0FBWSxRQUFRLHdCQUFtQixJQUFJLENBQUMsSUFBSSxVQUFLLFFBQVEsV0FBTSxXQUFXLFFBQUssQ0FBQTtBQUM5RixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ2xhc3MsIFByb3BlcnR5LCBGaWxlLCBnZXRDb21tZW50SGVhZGVyLCBDb250ZXh0IH0gZnJvbSBcIi4uL3R5cGVzXCI7XG5pbXBvcnQgeyBHZW5lcmF0ZU9wdGlvbnMgfSBmcm9tIFwiLi4vYXBpXCI7XG5cbmNvbnN0IHR5cGVNYXBzID0ge1xuICAgIFwic3RyaW5nXCI6IFwiU3RyaW5nXCIsXG4gICAgXCJudW1iZXJcIjogXCJEeW5hbWljXCIsXG4gICAgXCJib29sZWFuXCI6IFwiQm9vbFwiLFxuICAgIFwiaW50OFwiOiBcIkludFwiLFxuICAgIFwidWludDhcIjogXCJVSW50XCIsXG4gICAgXCJpbnQxNlwiOiBcIkludFwiLFxuICAgIFwidWludDE2XCI6IFwiVUludFwiLFxuICAgIFwiaW50MzJcIjogXCJJbnRcIixcbiAgICBcInVpbnQzMlwiOiBcIlVJbnRcIixcbiAgICBcImludDY0XCI6IFwiSW50XCIsXG4gICAgXCJ1aW50NjRcIjogXCJVSW50XCIsXG4gICAgXCJmbG9hdDMyXCI6IFwiRmxvYXRcIixcbiAgICBcImZsb2F0NjRcIjogXCJGbG9hdFwiLFxufVxuXG5jb25zdCB0eXBlSW5pdGlhbGl6ZXIgPSB7XG4gICAgXCJzdHJpbmdcIjogJ1wiXCInLFxuICAgIFwibnVtYmVyXCI6IFwiMFwiLFxuICAgIFwiYm9vbGVhblwiOiBcImZhbHNlXCIsXG4gICAgXCJpbnQ4XCI6IFwiMFwiLFxuICAgIFwidWludDhcIjogXCIwXCIsXG4gICAgXCJpbnQxNlwiOiBcIjBcIixcbiAgICBcInVpbnQxNlwiOiBcIjBcIixcbiAgICBcImludDMyXCI6IFwiMFwiLFxuICAgIFwidWludDMyXCI6IFwiMFwiLFxuICAgIFwiaW50NjRcIjogXCIwXCIsXG4gICAgXCJ1aW50NjRcIjogXCIwXCIsXG4gICAgXCJmbG9hdDMyXCI6IFwiMFwiLFxuICAgIFwiZmxvYXQ2NFwiOiBcIjBcIixcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdlbmVyYXRlIChjb250ZXh0OiBDb250ZXh0LCBvcHRpb25zOiBHZW5lcmF0ZU9wdGlvbnMpOiBGaWxlW10ge1xuICAgIHJldHVybiBjb250ZXh0LmNsYXNzZXMubWFwKGtsYXNzID0+ICh7XG4gICAgICAgIG5hbWU6IGtsYXNzLm5hbWUgKyBcIi5oeFwiLFxuICAgICAgICBjb250ZW50OiBnZW5lcmF0ZUNsYXNzKGtsYXNzLCBvcHRpb25zLm5hbWVzcGFjZSwgY29udGV4dC5jbGFzc2VzKVxuICAgIH0pKTtcbn1cblxuZnVuY3Rpb24gZ2V0SW5oZXJpdGFuY2VUcmVlKGtsYXNzOiBDbGFzcywgYWxsQ2xhc3NlczogQ2xhc3NbXSwgaW5jbHVkZVNlbGY6IGJvb2xlYW4gPSB0cnVlKSB7XG4gICAgbGV0IGN1cnJlbnRDbGFzcyA9IGtsYXNzO1xuICAgIGxldCBpbmhlcml0YW5jZVRyZWU6IENsYXNzW10gPSBbXTtcblxuICAgIGlmIChpbmNsdWRlU2VsZikge1xuICAgICAgICBpbmhlcml0YW5jZVRyZWUucHVzaChjdXJyZW50Q2xhc3MpO1xuICAgIH1cblxuICAgIHdoaWxlIChjdXJyZW50Q2xhc3MuZXh0ZW5kcyAhPT0gXCJTY2hlbWFcIikge1xuICAgICAgICBjdXJyZW50Q2xhc3MgPSBhbGxDbGFzc2VzLmZpbmQoa2xhc3MgPT4ga2xhc3MubmFtZSA9PSBjdXJyZW50Q2xhc3MuZXh0ZW5kcyk7XG4gICAgICAgIGluaGVyaXRhbmNlVHJlZS5wdXNoKGN1cnJlbnRDbGFzcyk7XG4gICAgfVxuXG4gICAgcmV0dXJuIGluaGVyaXRhbmNlVHJlZTtcbn1cblxuZnVuY3Rpb24gZ2VuZXJhdGVDbGFzcyhrbGFzczogQ2xhc3MsIG5hbWVzcGFjZTogc3RyaW5nLCBhbGxDbGFzc2VzOiBDbGFzc1tdKSB7XG4gICAgcmV0dXJuIGAke2dldENvbW1lbnRIZWFkZXIoKX1cblxuJHtuYW1lc3BhY2UgPyBgcGFja2FnZSAke25hbWVzcGFjZX07YCA6IFwiXCJ9XG5pbXBvcnQgaW8uY29seXNldXMuc2VyaWFsaXplci5zY2hlbWEuU2NoZW1hO1xuaW1wb3J0IGlvLmNvbHlzZXVzLnNlcmlhbGl6ZXIuc2NoZW1hLnR5cGVzLio7XG5cbmNsYXNzICR7a2xhc3MubmFtZX0gZXh0ZW5kcyAke2tsYXNzLmV4dGVuZHN9IHtcbiR7a2xhc3MucHJvcGVydGllcy5tYXAocHJvcCA9PiBnZW5lcmF0ZVByb3BlcnR5KHByb3ApKS5qb2luKFwiXFxuXCIpfVxufVxuYDtcbn1cblxuZnVuY3Rpb24gZ2VuZXJhdGVQcm9wZXJ0eShwcm9wOiBQcm9wZXJ0eSkge1xuICAgIGxldCBsYW5nVHlwZTogc3RyaW5nO1xuICAgIGxldCBpbml0aWFsaXplciA9IFwiXCI7XG4gICAgbGV0IHR5cGVBcmdzID0gYFwiJHtwcm9wLnR5cGV9XCJgO1xuXG4gICAgaWYgKHByb3AuY2hpbGRUeXBlKSB7XG4gICAgICAgIGNvbnN0IGlzVXBjYXNlRmlyc3QgPSBwcm9wLmNoaWxkVHlwZS5tYXRjaCgvXltBLVpdLyk7XG5cbiAgICAgICAgaWYgKGlzVXBjYXNlRmlyc3QpIHtcbiAgICAgICAgICAgIHR5cGVBcmdzICs9IGAsICR7cHJvcC5jaGlsZFR5cGV9YDtcblxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdHlwZUFyZ3MgKz0gYCwgXCIke3Byb3AuY2hpbGRUeXBlfVwiYDtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmKHByb3AudHlwZSA9PT0gXCJyZWZcIikge1xuICAgICAgICAgICAgbGFuZ1R5cGUgPSBgJHtwcm9wLmNoaWxkVHlwZX1gO1xuICAgICAgICAgICAgaW5pdGlhbGl6ZXIgPSBgbmV3ICR7cHJvcC5jaGlsZFR5cGV9KClgO1xuXG4gICAgICAgIH0gZWxzZSBpZihwcm9wLnR5cGUgPT09IFwiYXJyYXlcIikge1xuICAgICAgICAgICAgbGFuZ1R5cGUgPSAoaXNVcGNhc2VGaXJzdClcbiAgICAgICAgICAgICAgICA/IGBBcnJheVNjaGVtYTwke3Byb3AuY2hpbGRUeXBlfT5gXG4gICAgICAgICAgICAgICAgOiBgQXJyYXlTY2hlbWE8JHt0eXBlTWFwc1twcm9wLmNoaWxkVHlwZV19PmA7XG4gICAgICAgICAgICBpbml0aWFsaXplciA9IGBuZXcgJHtsYW5nVHlwZX0oKWA7XG5cbiAgICAgICAgfSBlbHNlIGlmKHByb3AudHlwZSA9PT0gXCJtYXBcIikge1xuICAgICAgICAgICAgbGFuZ1R5cGUgPSAoaXNVcGNhc2VGaXJzdClcbiAgICAgICAgICAgICAgICA/IGBNYXBTY2hlbWE8JHtwcm9wLmNoaWxkVHlwZX0+YFxuICAgICAgICAgICAgICAgIDogYE1hcFNjaGVtYTwke3R5cGVNYXBzW3Byb3AuY2hpbGRUeXBlXX0+YDtcbiAgICAgICAgICAgIGluaXRpYWxpemVyID0gYG5ldyAke2xhbmdUeXBlfSgpYDtcbiAgICAgICAgfVxuXG4gICAgfSBlbHNlIHtcbiAgICAgICAgbGFuZ1R5cGUgPSB0eXBlTWFwc1twcm9wLnR5cGVdO1xuICAgICAgICBpbml0aWFsaXplciA9IHR5cGVJbml0aWFsaXplcltwcm9wLnR5cGVdO1xuICAgIH1cblxuICAgIHJldHVybiBgXFx0QDp0eXBlKCR7dHlwZUFyZ3N9KVxcblxcdHB1YmxpYyB2YXIgJHtwcm9wLm5hbWV9OiAke2xhbmdUeXBlfSA9ICR7aW5pdGlhbGl6ZXJ9O1xcbmBcbn1cbiJdfQ==