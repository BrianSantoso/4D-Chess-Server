"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.SchemaSerializer = void 0;
var schema_1 = require("@colyseus/schema");
var SchemaSerializer = /** @class */ (function () {
    function SchemaSerializer() {
    }
    SchemaSerializer.prototype.setState = function (rawState) {
        this.state.decode(rawState);
    };
    SchemaSerializer.prototype.getState = function () {
        return this.state;
    };
    SchemaSerializer.prototype.patch = function (patches) {
        this.state.decode(patches);
    };
    SchemaSerializer.prototype.teardown = function () {
        var _a, _b;
        (_b = (_a = this.state) === null || _a === void 0 ? void 0 : _a['$changes']) === null || _b === void 0 ? void 0 : _b.root.clearRefs();
    };
    SchemaSerializer.prototype.handshake = function (bytes, it) {
        if (this.state) {
            // validate client/server definitinos
            var reflection = new schema_1.Reflection();
            reflection.decode(bytes, it);
        }
        else {
            // initialize reflected state from server
            this.state = schema_1.Reflection.decode(bytes, it);
        }
    };
    return SchemaSerializer;
}());
exports.SchemaSerializer = SchemaSerializer;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiU2NoZW1hU2VyaWFsaXplci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9zZXJpYWxpemVyL1NjaGVtYVNlcmlhbGl6ZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBQ0EsMkNBQXNEO0FBS3REO0lBQUE7SUE4QkEsQ0FBQztJQTNCRyxtQ0FBUSxHQUFSLFVBQVMsUUFBYTtRQUNsQixJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsQ0FBQztJQUNoQyxDQUFDO0lBRUQsbUNBQVEsR0FBUjtRQUNJLE9BQU8sSUFBSSxDQUFDLEtBQUssQ0FBQztJQUN0QixDQUFDO0lBRUQsZ0NBQUssR0FBTCxVQUFNLE9BQU87UUFDVCxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUMvQixDQUFDO0lBRUQsbUNBQVEsR0FBUjs7UUFDSSxZQUFBLElBQUksQ0FBQyxLQUFLLDBDQUFHLFVBQVUsMkNBQUcsSUFBSSxDQUFDLFNBQVMsR0FBRztJQUMvQyxDQUFDO0lBRUQsb0NBQVMsR0FBVCxVQUFVLEtBQWUsRUFBRSxFQUFhO1FBQ3BDLElBQUksSUFBSSxDQUFDLEtBQUssRUFBRTtZQUNaLHFDQUFxQztZQUNyQyxJQUFNLFVBQVUsR0FBRyxJQUFJLG1CQUFVLEVBQUUsQ0FBQztZQUNwQyxVQUFVLENBQUMsTUFBTSxDQUFDLEtBQUssRUFBRSxFQUFFLENBQUMsQ0FBQztTQUVoQzthQUFNO1lBQ0gseUNBQXlDO1lBQ3pDLElBQUksQ0FBQyxLQUFLLEdBQUcsbUJBQVUsQ0FBQyxNQUFNLENBQUMsS0FBSyxFQUFFLEVBQUUsQ0FBUSxDQUFDO1NBQ3BEO0lBQ0wsQ0FBQztJQUNMLHVCQUFDO0FBQUQsQ0FBQyxBQTlCRCxJQThCQztBQTlCWSw0Q0FBZ0IiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBTZXJpYWxpemVyIH0gZnJvbSBcIi4vU2VyaWFsaXplclwiO1xuaW1wb3J0IHsgU2NoZW1hLCBSZWZsZWN0aW9uIH0gZnJvbSBcIkBjb2x5c2V1cy9zY2hlbWFcIjtcbmltcG9ydCB7IEl0ZXJhdG9yIH0gZnJvbSBcIkBjb2x5c2V1cy9zY2hlbWEvbGliL2VuY29kaW5nL2RlY29kZVwiO1xuXG5leHBvcnQgdHlwZSBTY2hlbWFDb25zdHJ1Y3RvcjxUID0gU2NoZW1hPiA9IG5ldyAoLi4uYXJnczogYW55W10pID0+IFQ7XG5cbmV4cG9ydCBjbGFzcyBTY2hlbWFTZXJpYWxpemVyPFQgZXh0ZW5kcyBTY2hlbWEgPSBhbnk+IGltcGxlbWVudHMgU2VyaWFsaXplcjxUPiB7XG4gICAgc3RhdGU6IFQ7XG5cbiAgICBzZXRTdGF0ZShyYXdTdGF0ZTogYW55KTogdm9pZCB7XG4gICAgICAgIHRoaXMuc3RhdGUuZGVjb2RlKHJhd1N0YXRlKTtcbiAgICB9XG5cbiAgICBnZXRTdGF0ZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc3RhdGU7XG4gICAgfVxuXG4gICAgcGF0Y2gocGF0Y2hlcykge1xuICAgICAgICB0aGlzLnN0YXRlLmRlY29kZShwYXRjaGVzKTtcbiAgICB9XG5cbiAgICB0ZWFyZG93bigpIHtcbiAgICAgICAgdGhpcy5zdGF0ZT8uWyckY2hhbmdlcyddPy5yb290LmNsZWFyUmVmcygpO1xuICAgIH1cblxuICAgIGhhbmRzaGFrZShieXRlczogbnVtYmVyW10sIGl0PzogSXRlcmF0b3IpIHtcbiAgICAgICAgaWYgKHRoaXMuc3RhdGUpIHtcbiAgICAgICAgICAgIC8vIHZhbGlkYXRlIGNsaWVudC9zZXJ2ZXIgZGVmaW5pdGlub3NcbiAgICAgICAgICAgIGNvbnN0IHJlZmxlY3Rpb24gPSBuZXcgUmVmbGVjdGlvbigpO1xuICAgICAgICAgICAgcmVmbGVjdGlvbi5kZWNvZGUoYnl0ZXMsIGl0KTtcblxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy8gaW5pdGlhbGl6ZSByZWZsZWN0ZWQgc3RhdGUgZnJvbSBzZXJ2ZXJcbiAgICAgICAgICAgIHRoaXMuc3RhdGUgPSBSZWZsZWN0aW9uLmRlY29kZShieXRlcywgaXQpIGFzIGFueTtcbiAgICAgICAgfVxuICAgIH1cbn1cbiJdfQ==